<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Why dplyover? • dplyover</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Why dplyover?">
<meta property="og:description" content="dplyover">
<meta property="og:image" content="https://timteafan.github.io/dplyover/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dplyover</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-tools"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book-open"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/why_dplyover.html">Why dplyover?</a>
    </li>
    <li>
      <a href="../articles/performance.html">Performance and Compability</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-clipboard-list"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://twitter.com/timteafan">
    <span class="fab fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/TimTeaFan/dplyover/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="why_dplyover_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Why dplyover?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TimTeaFan/dplyover/blob/master/vignettes/why_dplyover.Rmd"><code>vignettes/why_dplyover.Rmd</code></a></small>
      <div class="hidden name"><code>why_dplyover.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>{dplyover} extends {dplyr}’s functionality by building a function family around <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across()</a></code>.</p>
<p>The goal of this <em>over-across function family</em> is to provide a concise and uniform syntax which can be used to create columns by applying functions to vectors and/or sets of columns in {dplyr}. Ideally, this will:</p>
<ul>
<li>
<strong>reduce the amount of code</strong> to create variables derived from existing colums, which is especially helpful when doing explanatory data analysis (e.g. lagging, collapsing, recoding etc. many variables in a similar way).</li>
<li>
<strong>provide a clean {dplyr} approach</strong> to create many variables which are calculated based on two or more variables.</li>
<li>
<strong>improve our mental model</strong> so that it is easier to tackle problems where the solution is based on creating new columns.</li>
</ul>
<p>To illustrate the points above it is helpful to look at a couple of use cases. This vignette will (i) look at four examples, (ii) present some alternatives that do not rely on {dplyover} and (iii) elaborate on the pros and cons.</p>
</div>
<div id="use-cases-and-workarounds" class="section level2">
<h2 class="hasAnchor">
<a href="#use-cases-and-workarounds" class="anchor"></a>Use cases and workarounds</h2>
<p>In this section we will look at three different use cases of {dplyover}:</p>
<ol style="list-style-type: decimal">
<li>Create columns derived from a comma separated character vector</li>
<li>Creating several lagged variables for a set of columns</li>
<li>Applying functions to a set of variable pairs</li>
</ol>
<p>Before we begin, here is our setup:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TimTeaFan/dplyover">dplyover</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/bench">bench</a></span><span class="op">)</span></code></pre></div>
<div id="create-columns-derived-from-a-comma-separated-character-vector" class="section level4">
<h4 class="hasAnchor">
<a href="#create-columns-derived-from-a-comma-separated-character-vector" class="anchor"></a>Create columns derived from a comma separated character vector</h4>
<p>{dplyover} helps us to think in terms of columns that we want to create. A good example, when this kind of thinking is useful, is when dealing with a comma separated character vector. In the example below the column ‘csat_open’ contains one or several comma separated reasons why a good or bad satisfaction rating was given. We want to transform the data so that each unique reason in ‘csat_open’ gets its own column in form of a dummy variable: taking <code>1</code> when the reason was given and <code>0</code> otherwise. To do this we use <code>over</code> together with <code>dist_values</code> which is a wrapper around <code>unique</code> that splits comma separated strings when a separator is provided in <code>.sep</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">csat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">csat_open</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># for better printing</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/over.html">over</a></span><span class="op">(</span><span class="fu"><a href="../reference/select_values.html">dist_values</a></span><span class="op">(</span><span class="va">csat_open</span>, .sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,
              <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">csat_open</span><span class="op">)</span><span class="op">)</span>,
              .names <span class="op">=</span> <span class="st">"rsp_{x}"</span>,
              .names_fn <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
 <span class="va">glimpse</span> <span class="co"># for better printing</span>
<span class="co">#&gt; Rows: 150</span>
<span class="co">#&gt; Columns: 7</span>
<span class="co">#&gt; $ csat_open          &lt;chr&gt; "good service", "unfriendly", "too expensive, unfri~</span>
<span class="co">#&gt; $ rsp_friendly_staff &lt;int&gt; 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, ~</span>
<span class="co">#&gt; $ rsp_good_service   &lt;int&gt; 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, ~</span>
<span class="co">#&gt; $ rsp_great_product  &lt;int&gt; 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, ~</span>
<span class="co">#&gt; $ rsp_no_response    &lt;int&gt; 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, ~</span>
<span class="co">#&gt; $ rsp_too_expensive  &lt;int&gt; 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, ~</span>
<span class="co">#&gt; $ rsp_unfriendly     &lt;int&gt; 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, ~</span></code></pre></div>
<p><code>over</code> makes it easy to think about the problem we are dealing with. We just iterate over all unique values in <code>csat_open</code> and check with <code>grepl</code> if the value is present. The first two arguments would suffice to produce a useable result. Here, we additionally use the <code>.names</code> and <code>.names_fn</code> arguments to create nice column names by appending a prefix (‘rsp_’) and replacing the white spaces with underscores.</p>
<p>A tidyverse approach that comes close to <code>over</code>’s functionality is to use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_dfc</a></code> inside <code>mutate</code>. The only difference is that we have to create a named vector, which holds the new column names as names, and the unique values of “csat_open” as values. This makes this approach less pipe-friendly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">var_nms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">csat</span><span class="op">$</span><span class="va">csat_open</span>, <span class="st">", "</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">unlist</span> <span class="op">%&gt;%</span> <span class="va">unique</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"rsp_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">csat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfc</a></span><span class="op">(</span><span class="va">var_nms</span>,
              <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">csat_open</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>While <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_dfc</a></code> is a valid workaround, it is less known and therefore not often used in the wild (at least this is my anecdotal evidence that comes from looking at answers to similar questions on Stackoverflow).</p>
<p>A more common way to tackle this problem within the tidyverse is to use {tidyr}. Here we first use <code>separate_rows</code> and make the data longer. Then we use <code>pivot_wider</code> to generate the columns we are interested in. Although the code is not much longer, we have to do some thinking about how to set up <code>pviot_wider</code> to yield our desired result. And although we make use of a lot of <code>pivot_wider</code>’s arguments, the column names still require a finishing touch.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">csat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html">separate_rows</a></span><span class="op">(</span><span class="va">csat_open</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">csat_open</span>,
              names_prefix <span class="op">=</span> <span class="st">"rsp_"</span>,
              names_repair <span class="op">=</span> <span class="st">"universal"</span>,
              values_from <span class="op">=</span> <span class="va">csat_open</span>,
              values_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span>,
              values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"rsp_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># for better printing</span>
  <span class="va">glimpse</span> <span class="co"># for better printing</span>
<span class="co">#&gt; New names:</span>
<span class="co">#&gt; * `rsp_good service` -&gt; rsp_good.service</span>
<span class="co">#&gt; * `rsp_too expensive` -&gt; rsp_too.expensive</span>
<span class="co">#&gt; * `rsp_no response` -&gt; rsp_no.response</span>
<span class="co">#&gt; * `rsp_friendly staff` -&gt; rsp_friendly.staff</span>
<span class="co">#&gt; * `rsp_great product` -&gt; rsp_great.product</span>
<span class="co">#&gt; Rows: 150</span>
<span class="co">#&gt; Columns: 6</span>
<span class="co">#&gt; $ rsp_good.service   &lt;dbl&gt; 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, ~</span>
<span class="co">#&gt; $ rsp_unfriendly     &lt;dbl&gt; 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, ~</span>
<span class="co">#&gt; $ rsp_too.expensive  &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, ~</span>
<span class="co">#&gt; $ rsp_no.response    &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, ~</span>
<span class="co">#&gt; $ rsp_friendly.staff &lt;dbl&gt; 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, ~</span>
<span class="co">#&gt; $ rsp_great.product  &lt;dbl&gt; 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, ~</span></code></pre></div>
<p>Another approach is to (i) get all unique values in “csat_open” and use them to (ii) create empty columns filled with zeros. Then (iii) we can use <code>cur_column</code> with <code>grepl</code> inside <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code> to test if the current column name is present in ‘csat_open’. This approach has two negative aspects. First, it is not pipe-friendly. Second, creating nice column names isn’t easy. This comes as a surprise, since <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code> has a <code>.names</code> argument. This lets us append a prefix, but it does not let us replace whitespaces with underscores. Further, once we make use of the <code>.names</code> argument, new copies of the input columns are generated, so we need to get rid of the old columns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">var_nms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">csat</span><span class="op">$</span><span class="va">csat_open</span>, <span class="st">", "</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">unlist</span> <span class="op">%&gt;%</span> <span class="va">unique</span>

<span class="co"># instead of the set_names below we could do the following in base R:</span>
<span class="co"># csat[, var_nms] &lt;- 0</span>
<span class="va">csat</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">var_nms</span><span class="op">)</span><span class="op">)</span>, <span class="va">var_nms</span><span class="op">)</span>, 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">var_nms</span><span class="op">)</span>, 
                   <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">cur_column</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">csat_open</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">as.integer</span>,
                   .names <span class="op">=</span> <span class="st">"rsp_{col}"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">var_nms</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="va">glimpse</span> <span class="co"># for better printing</span>
<span class="co">#&gt; Rows: 150</span>
<span class="co">#&gt; Columns: 6</span>
<span class="co">#&gt; $ `rsp_good service`   &lt;int&gt; 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0~</span>
<span class="co">#&gt; $ rsp_unfriendly       &lt;int&gt; 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1~</span>
<span class="co">#&gt; $ `rsp_too expensive`  &lt;int&gt; 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1~</span>
<span class="co">#&gt; $ `rsp_no response`    &lt;int&gt; 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1~</span>
<span class="co">#&gt; $ `rsp_friendly staff` &lt;int&gt; 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0~</span>
<span class="co">#&gt; $ `rsp_great product`  &lt;int&gt; 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0~</span></code></pre></div>
<p>If we look at the performance of each approach, we can see that <code>map_dfc</code> is fastest, while is <code>pivot_wider</code> is slowest. <code>across</code> and <code>over</code> range somewhere in between.</p>
<pre><code>#&gt; # A tibble: 4 x 3
#&gt;   expression    median mem_alloc
#&gt;   &lt;bch:expr&gt;  &lt;bch:tm&gt; &lt;bch:byt&gt;
#&gt; 1 over          4.32ms    25.9KB
#&gt; 2 map_dfc       3.66ms    24.6KB
#&gt; 3 pivot_wider  10.49ms   139.8KB
#&gt; 4 across         6.7ms    61.7KB</code></pre>
</div>
<div id="creating-several-lagged-variables-for-a-set-of-columns" class="section level4">
<h4 class="hasAnchor">
<a href="#creating-several-lagged-variables-for-a-set-of-columns" class="anchor"></a>Creating several lagged variables for a set of columns</h4>
<p>In exploratory data analysis creating a range of lagged variants of several variables is not an uncommon use case. Let’s take the <code>diamonds</code> data set from {ggplot2} and create five lagged versions of columns ‘x’, ‘y’ and ‘z’ by positions <code>1</code> to <code>5</code>. <code>crossover</code> allows us to iterate a set of columns over a vector:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/crossover.html">crossover</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span>,
                   <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span><span class="op">)</span>,
                   .names <span class="op">=</span> <span class="st">"{xcol}_{fn}{y}"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 53,940 x 25</span>
<span class="co">#&gt;   carat cut     color clarity depth table price     x     y     z x_lag1 x_lag2</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 0.23  Ideal   E     SI2      61.5    55   326  3.95  3.98  2.43  NA     NA   </span>
<span class="co">#&gt; 2 0.21  Premium E     SI1      59.8    61   326  3.89  3.84  2.31   3.95  NA   </span>
<span class="co">#&gt; 3 0.23  Good    E     VS1      56.9    65   327  4.05  4.07  2.31   3.89   3.95</span>
<span class="co">#&gt; 4 0.290 Premium I     VS2      62.4    58   334  4.2   4.23  2.63   4.05   3.89</span>
<span class="co">#&gt; # ... with 53,936 more rows, and 13 more variables: x_lag3 &lt;dbl&gt;, x_lag4 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x_lag5 &lt;dbl&gt;, y_lag1 &lt;dbl&gt;, y_lag2 &lt;dbl&gt;, y_lag3 &lt;dbl&gt;, y_lag4 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   y_lag5 &lt;dbl&gt;, ...</span></code></pre></div>
<p>While this was easy, there are of course other ways to approach this problem. We could use <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code> and just insert the call to <code>lag</code> five times manually in the <code>.fns</code> argument. However, in this vignette we only consider approaches that save us from repeating code patterns. One option is using {purrr}’s <code>map_dfc</code> inside <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span>,
                <span class="op">~</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfc</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lag"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
                          <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
                <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">data.frame</span>, <span class="va">.</span><span class="op">)</span></code></pre></div>
<p>This approach is pretty close to <code>crossover</code>, but we need to take care of two things. First, we have to create the variable names using <code><a href="https://purrr.tidyverse.org/reference/set_names.html">purrr::set_names</a></code>, otherwise our new variables would be named <code>x...1</code>, <code>x...2</code> and so on. Second, the original output of calling <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_dfc</a></code> within <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code> on three columns are three <code>tibble</code>s, each containing the lagged variants of one column. To turn each <code>tibble</code> into five proper columns of our original data we need to pipe the final result into a <code><a href="https://rdrr.io/r/base/do.call.html">do.call(data.frame, .)</a></code>. All in all, although staying in the tidyverse, the <code>map</code> call nested in <code>across</code>, together with <code>set_names</code> and the final <code>do.call</code> make this approach less readable.</p>
<p>Finally, another approach would be to build a custom function and use <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce2</a></code> to call several <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code> calls in a row, each with the input of the last call’s output.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">create_lags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"{.x}_lag{.y}"</span> <span class="op">:=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, <span class="va">.y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">diamonds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>,
          <span class="va">create_lags</span>,
          .init <span class="op">=</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<p>This approach is very clever, and {purrr}’s <code>reduce</code> function is a pipe-friendly approach which works great with {dplyr}’s one-table verbs. However, here too we have to take care of two things: First, using NSE in the custom function requires some advanced knowledge of the tidyverse. (i) How do we create nice names on the lefthand side of the walrus operator <code>:=</code>? (ii) How do we evaluate strings as column names? Second, figuring out how to setup <code>reduce2</code> to work with our custom function. Our original data goes in to <code>.init</code> argument, the arguments we want to loop over need to be repeated in a way that ensures that each combination of elements is created.</p>
<p>Finally, we compare the performance of each operation. The table below shows that using <code>map_dfc</code> within <code>across</code> is the most performant approach, while using a custom function with <code>reduce</code> is the least performant. <code>crossover</code> is not too far off in terms of speed compared to the <code>map_dfc</code> approach. The big gain of using <code>crossover</code> is that it reduces the cognitive load of figuring out how to use advanced tidyverse workarounds (like <code>reduce</code> or a <code>map</code> call nested in <code>across</code>).</p>
<pre><code>#&gt; # A tibble: 3 x 3
#&gt;   expression          median mem_alloc
#&gt;   &lt;bch:expr&gt;        &lt;bch:tm&gt; &lt;bch:byt&gt;
#&gt; 1 crossover           18.7ms      26MB
#&gt; 2 across_map_dfc      15.6ms    15.4MB
#&gt; 3 custom_fct_reduce     50ms    15.6MB</code></pre>
</div>
<div id="applying-functions-to-a-set-of-variable-pairs" class="section level4">
<h4 class="hasAnchor">
<a href="#applying-functions-to-a-set-of-variable-pairs" class="anchor"></a>Applying functions to a set of variable pairs</h4>
<p>Some data sets contain many variable with similar patterns. A ‘tiny’ example is the <code>ìris</code> data set, containing columns with combinations of ‘Sepal’ and ‘Petal’ with ‘Length’ and ‘Width’. In the example below we want to calculate the product and the sum of both pairs of ‘Length’ and ‘Width’ variables. For problems like like this <code>across2</code> is the perfect tool. It works just like <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code>, but let’s us choose <em>two</em> sets of columns - <code>.xcols</code> and <code>.ycols</code>. <code>across2</code> allows us to use a special glue specification, <code>{pre}</code>, in its <code>.names</code> argument, which will evaluate to the common prefix of each variable pair.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/across2.html">across2</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"Length"</span><span class="op">)</span>,
                 <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"Width"</span><span class="op">)</span>,
                 .fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>product <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">*</span> <span class="va">.y</span>,
                             sum <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">+</span> <span class="va">.y</span><span class="op">)</span>,
                 .names <span class="op">=</span> <span class="st">"{pre}_{fn}"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">glimpse</span>
<span class="co">#&gt; Rows: 150</span>
<span class="co">#&gt; Columns: 9</span>
<span class="co">#&gt; $ Sepal.Length  &lt;dbl&gt; 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4~</span>
<span class="co">#&gt; $ Sepal.Width   &lt;dbl&gt; 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3~</span>
<span class="co">#&gt; $ Petal.Length  &lt;dbl&gt; 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1~</span>
<span class="co">#&gt; $ Petal.Width   &lt;dbl&gt; 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0~</span>
<span class="co">#&gt; $ Species       &lt;fct&gt; setosa, setosa, setosa, setosa, setosa, setosa, setosa, ~</span>
<span class="co">#&gt; $ Sepal_product &lt;dbl&gt; 18, 15, 15, 14, 18, 21, 16, 17, 13, 15, 20, 16, 14, 13, ~</span>
<span class="co">#&gt; $ Sepal_sum     &lt;dbl&gt; 8.6, 7.9, 7.9, 7.7, 8.6, 9.3, 8.0, 8.4, 7.3, 8.0, 9.1, 8~</span>
<span class="co">#&gt; $ Petal_product &lt;dbl&gt; 0.28, 0.28, 0.26, 0.30, 0.28, 0.68, 0.42, 0.30, 0.28, 0.~</span>
<span class="co">#&gt; $ Petal_sum     &lt;dbl&gt; 1.6, 1.6, 1.5, 1.7, 1.6, 2.1, 1.7, 1.7, 1.6, 1.6, 1.7, 1~</span></code></pre></div>
<p>While in this case a simple call to <code>mutate</code> (defining two new varialbes) would have done the job, <code>across2</code> really comes in handy when we are dealing with data sets with many variables that need to be computed in a similar way.</p>
<p>Again, there are different workarounds to produce the same result. One option is to use <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/context.html">dplyr::cur_column</a></code>. First we shorten the names of ‘Sepal.Length’ and ‘Petal.Length’ to their stem using <code><a href="https://dplyr.tidyverse.org/reference/rename.html">dplyr::rename_with</a></code>. This allows us to use <code>paste0</code> to construct the names of the ‘Width’ variables. Below we use <code>get</code> on the so constructed names to get the underlying values (alternatively we could have used <code><a href="https://rdrr.io/r/base/eval.html">eval(sym())</a></code>). While this comes close to our desired result, we probably want to restore the original names. Unfortunately, this requires an additional setup, which is why we rename the variables manually below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>.fn <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".Length"</span>, <span class="st">""</span>, <span class="va">.x</span><span class="op">)</span>,
              .cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"Length"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Sepal</span>, <span class="va">Petal</span><span class="op">)</span>, 
                <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>product <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">cur_column</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".Width"</span><span class="op">)</span><span class="op">)</span>,
                     sum <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">cur_column</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".Width"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Sepal.Length <span class="op">=</span> <span class="va">Sepal</span>,
         Petal.Length <span class="op">=</span> <span class="va">Petal</span><span class="op">)</span></code></pre></div>
<p>Another approach is again {purrr}’s <code>reduce2</code> in combination with a custom function. Apart from the data, <code>df</code>, our custom function takes two strings as arguments: <code>.x</code> is the common stem of our variable pairs, and <code>.y</code> which is the name of the operation we want to perform. The downside of this approach was already mentioned above: (i) advanced NSE knowledge and (ii) figuring out how to use <code>reduce2</code>, especially building the inputs using <code>rep</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">create_vars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"{.x}_{.y}"</span> <span class="op">:=</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span><span class="va">.y</span>,
                                     sum <span class="op">=</span> <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">".Width"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
                                           <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">".Length"</span><span class="op">)</span><span class="op">)</span>,
                                     product <span class="op">=</span> <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">".Width"</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span>
                                               <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">".Length"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>
<span class="op">}</span>

<span class="va">iris</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sepal"</span>, <span class="st">"Petal"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"product"</span>, <span class="st">"sum"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,
          <span class="va">create_vars</span>,
          .init <span class="op">=</span> <span class="va">.</span><span class="op">)</span> </code></pre></div>
<p>Comparing the three operations above in terms of speed shows that <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code> is the most performant. This time, <code>reduce2</code> follows closely and <code>across2</code> is the least performant. Although being slower, <code>across2</code> has several advantages:</p>
<ol style="list-style-type: decimal">
<li>No knowledge of NSE or {purrr}’s <code>reduce</code> is needed.</li>
<li>Its the most readable approach.</li>
<li>It allows us to produce nice names, including a common pre- or suffix.</li>
<li>It does not depend on the variables having to share a common stem.</li>
</ol>
<pre><code>#&gt; # A tibble: 3 x 3
#&gt;   expression          median mem_alloc
#&gt;   &lt;bch:expr&gt;        &lt;bch:tm&gt; &lt;bch:byt&gt;
#&gt; 1 across2            13.75ms   596.8KB
#&gt; 2 across              5.34ms    72.3KB
#&gt; 3 custom_fct_reduce   8.05ms      76KB</code></pre>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>Above we have discussed three use cases of {dplyover}’s <em>over-across function family</em>. We saw that each use case could be solved with other tidyverse functions or workarounds. However, each alternative approach had it’s own drawback: Either creating nice column names wasn’t straight forward, or we had to get our head around NSE and advanced functions such as <code>reduce</code>. Most of the alternative approaches were also less readable and less pipe-friendly. But most of all, we saw that there is no uniform approach to a common problem: creating columns based on vectors and/or sets of columns.</p>
<p>For this specific problem the <em>over-across function family</em>:</p>
<ul>
<li>provides a concise and uniform {dplyr} syntax similar to <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a></code>
</li>
<li>helps to write clean, readable, and pipe-friendly code without repetitions</li>
<li>improves our mental model so that we can focus more on functions to create columns (and less on data rectangling)</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tim Tiefenbach.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
